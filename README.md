## 1 . Снимаем копию штатного плазмоида

Создадим в домашней папке рабочую копию, чтобы не трогать системные файлы:

```bash
mkdir -p ~/.local/share/plasma/plasmoids
cp -r /usr/share/plasma/plasmoids/org.kde.plasma.taskmanager \
      ~/.local/share/plasma/plasmoids/org.kde.plasma.taskmanager.indexed
```

*(По такому же принципу KDE-разработчики советуют копировать другие виджеты — см. пример с Digital
Clock)([discuss.kde.org][1]).*

---

## 2 . Переименовываем виджет

1. **Откройте `metadata.json`** в новой папке `…/plasmoids/org.kde.plasma.taskmanager.indexed/`.

2. Найдите начало блока:

```json
"KPlugin": {
…
"Id": "org.kde.plasma.taskmanager",
"Name": "Task Manager",
"Version": "4.0",
…
}
```

* **`Id`** — должен быть уникален; обычно добавляют суффикс `.indexed`.
* **`Name`** — любое человекочитаемое; можно оставить переводы как есть, они не мешают.
* **`Version`** — любое число ≥ оригинала; удобно добавить «.1», чтобы Plasma увидела «новее».

---

## 3 . Патчим QML

В Plasma 6 корневым элементом делегата является **`PlasmaCore.ToolTipArea { id: task … }`**.

---

#### 3.1  Найдите блок `Loader { id: iconBox … }`

```qml
Loader {
    id: iconBox
    …
    PlasmaCore.IconItem {
        id: icon
        …
    }
    …
}
```

Сразу **после** закрывающей фигурной скобки `}` этого `Loader` (и **до** следующего элемента
`PlasmaComponents3.Label { id: label … }`) вставьте код ниже.

---

#### 3.2  Вставьте наложение-индекс

```qml
    /* ===== Индекс задачи слева-сверху ===== */
    Rectangle {
        id: indexBox

        // квадрат ~40 % высоты иконки
        width: iconBox.height * 0.50
        height: width
        radius: 2

        color: "white"                         // БЕЛЫЙ фон
        visible: task.itemIndex < 10

        anchors {
            top: iconBox.top
            left: iconBox.left
            margins: 1
        }

        z: 1000

        Text {
            id: indexLabel

            // переводим 0-based → 1…9,0
            text: ((task.itemIndex + 1) % 10).toString()

            anchors.centerIn: parent

            font.pixelSize: parent.height * 0.95   // БОЛЬШЕ цифра
            font.bold: true

	    color: "black"
        }
    }
    /* ======================================= */
```

---

## 4 . Ставим и перезапускаем

```bash
kquitapp5 plasmashell && kstart5 plasmashell &
```

---

## 5 . Добавляем новый апплет

* Правый клик по панели → **Добавить виджеты**.
* В поиске появится «Task Manager (with indices)».
* Перетащите его на панель и удалите старый Task Manager, чтобы индексы не дублировались.

---

## 6 . Поддержка после обновлений KDE

* Поскольку копия лежит в `~/.local/share`, системные апдейты её **не сотрут**, но и исправлений/фич из апстрима она не
  получит.
* После больших апдейтов Plasma иногда меняет внутренние QML-интерфейсы. Если «Indexed» перестал грузиться — сравните
  свежий `/usr/share/…/Task.qml` с вашим и перенесите правку ещё раз.

---

## 7 . Как откатить

```bash
kpackagetool5 -r org.kde.plasma.taskmanager.indexed
kquitapp5 plasmashell && kstart5 plasmashell &
```

---


## 8 . Чтобы новые окна не прыгали по панели (не получали максимальные индексы)
Позицию элементов на панели задаёт **режим сортировки и параметр «Separate Launchers»** ( «Отдельные закреплённые приложения» ).
По-умолчанию при открытии нового окна Task Manager ищет «правильное» место по своему алгоритму (последний активный, алфавит, и т. д.). Поэтому значок часто уходит в самый конец, и индексы «прыгают».

## Как зафиксировать порядок пунктов

### 1. Отключите разделение закреплённых значков

1. Правый клик → **Настроить «Панель задач»**
2. Вкладка **Поведение** (Behavior)
3. Снимите галочку **Separate Launchers** / «Разделять закреплённые приложения»
    → тогда окно будет «прятаться» под свой закреплённый ярлык, а не создавать новый элемент.

### 2. Включите ручную сортировку

В том же диалоге выберите **Sorting ▶ Manual** (или «Нет»/«Ручная»).
Теперь порядок можно менять только перетаскиванием мышью, и больше ничто его не переставит.
